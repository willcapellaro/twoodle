<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Depth Image Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .drop-zone {
            border: 2px dashed #555;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .drop-zone:hover {
            border-color: #007acc;
            background: rgba(0, 122, 204, 0.1);
        }
        
        .drop-zone.dragover {
            border-color: #007acc;
            background: rgba(0, 122, 204, 0.2);
        }
        
        .viewer {
            display: none;
            margin: 20px 0;
        }
        
        canvas {
            max-width: 100%;
            border-radius: 8px;
            cursor: move;
            display: block;
            margin: 0 auto;
        }
        
        .controls {
            margin: 20px 0;
            display: none;
            text-align: center;
        }
        
        .controls button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #005a9e;
        }
        
        .info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simple Depth Image Viewer</h1>
        <p>Upload any image to view and create depth maps</p>
        
        <div class="drop-zone" id="dropZone">
            <p>üìÅ Drag and drop your image here or click to select</p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
        </div>
        
        <div class="controls" id="controls">
            <button onclick="toggleDepth()">Toggle Depth View</button>
            <button onclick="downloadDepth()">Download Depth Map</button>
            <button onclick="reset()">Load New Image</button>
        </div>
        
        <div class="viewer" id="viewer">
            <canvas id="mainCanvas"></canvas>
        </div>
        
        <div class="info" id="info"></div>
    </div>

    <script>
        let mainImage = null;
        let depthMapData = null;
        let showingDepth = false;
        
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const viewer = document.getElementById('viewer');
        const controls = document.getElementById('controls');
        const info = document.getElementById('info');
        const mainCanvas = document.getElementById('mainCanvas');
        const ctx = mainCanvas.getContext('2d');
        
        // File handling
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);
        
        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }
        
        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                processFile(e.target.files[0]);
            }
        }
        
        function processFile(file) {
            if (!file.type.startsWith('image/')) {
                showInfo('Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                loadImage(e.target.result, file.name);
            };
            reader.readAsDataURL(file);
        }
        
        function loadImage(src, filename) {
            const img = new Image();
            img.onload = function() {
                mainImage = img;
                createDepthMap();
                displayImage();
                showInfo(`Loaded: ${filename} (${img.width}x${img.height})`);
            };
            img.src = src;
        }
        
        function createDepthMap() {
            if (!mainImage) return;
            
            // Create depth map canvas
            const depthCanvas = document.createElement('canvas');
            const depthCtx = depthCanvas.getContext('2d');
            depthCanvas.width = mainImage.width;
            depthCanvas.height = mainImage.height;
            
            // Draw original image
            depthCtx.drawImage(mainImage, 0, 0);
            
            // Get image data and create depth effect
            const imageData = depthCtx.getImageData(0, 0, depthCanvas.width, depthCanvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const x = (i / 4) % depthCanvas.width;
                const y = Math.floor((i / 4) / depthCanvas.width);
                
                // Create a radial depth effect
                const centerX = depthCanvas.width / 2;
                const centerY = depthCanvas.height / 2;
                const distance = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                const maxDistance = Math.sqrt(centerX ** 2 + centerY ** 2);
                
                // Convert to grayscale based on distance from center
                const brightness = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                const depth = Math.floor(brightness * (1 - distance / maxDistance));
                
                data[i] = depth;     // R
                data[i + 1] = depth; // G
                data[i + 2] = depth; // B
                // Alpha stays the same
            }
            
            depthCtx.putImageData(imageData, 0, 0);
            depthMapData = depthCanvas;
        }
        
        function displayImage() {
            if (!mainImage) return;
            
            // Setup main canvas
            mainCanvas.width = mainImage.width;
            mainCanvas.height = mainImage.height;
            ctx.drawImage(mainImage, 0, 0);
            
            // Show viewer and controls
            viewer.style.display = 'block';
            controls.style.display = 'block';
            dropZone.style.display = 'none';
            
            // Reset depth view
            showingDepth = false;
        }
        
        function toggleDepth() {
            if (!depthMapData) {
                showInfo('No depth map available');
                return;
            }
            
            showingDepth = !showingDepth;
            
            if (showingDepth) {
                ctx.drawImage(depthMapData, 0, 0);
                showInfo('Showing depth map');
            } else {
                ctx.drawImage(mainImage, 0, 0);
                showInfo('Showing original image');
            }
        }
        
        function downloadDepth() {
            if (!depthMapData) {
                showInfo('No depth map to download');
                return;
            }
            
            const link = document.createElement('a');
            link.download = 'depth-map.png';
            link.href = depthMapData.toDataURL();
            link.click();
            showInfo('Depth map downloaded');
        }
        
        function reset() {
            viewer.style.display = 'none';
            controls.style.display = 'none';
            info.style.display = 'none';
            dropZone.style.display = 'block';
            mainImage = null;
            depthMapData = null;
            showingDepth = false;
        }
        
        function showInfo(message) {
            info.textContent = message;
            info.style.display = 'block';
            setTimeout(() => {
                info.style.display = 'none';
            }, 3000);
        }
        
        // Add mouse parallax effect
        let mouseX = 0;
        let mouseY = 0;
        
        mainCanvas.addEventListener('mousemove', function(e) {
            if (!mainImage || showingDepth) return;
            
            const rect = this.getBoundingClientRect();
            mouseX = (e.clientX - rect.left) / rect.width;
            mouseY = (e.clientY - rect.top) / rect.height;
            
            applyParallax();
        });
        
        function applyParallax() {
            if (!mainImage || showingDepth) return;
            
            // Simple parallax effect based on mouse position
            const offsetX = (mouseX - 0.5) * 10;
            const offsetY = (mouseY - 0.5) * 10;
            
            mainCanvas.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        }
        
        mainCanvas.addEventListener('mouseleave', function() {
            mainCanvas.style.transform = 'translate(0px, 0px)';
        });
    </script>
</body>
</html>